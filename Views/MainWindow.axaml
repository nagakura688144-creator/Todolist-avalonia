<!-- Views/MainWindow.axaml -->
<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        x:Class="TodoApp.Views.MainWindow"
        Width="900" Height="640"
        Title="TodoApp">

  <!-- ===== リソース ===== -->
  <Window.Resources>
    <SolidColorBrush x:Key="ClrInputBg"     Color="#F3F4F6"/>
    <SolidColorBrush x:Key="ClrInputBorder" Color="#D1D5DB"/>
    <SolidColorBrush x:Key="ClrText"        Color="#111827"/>
    <SolidColorBrush x:Key="ClrBtnHover"    Color="#E5E7EB"/>
    <SolidColorBrush x:Key="ClrItemBg"      Color="#FBFBFB"/>
    <SolidColorBrush x:Key="ClrFocusBorder" Color="#93C5FD"/>
  </Window.Resources>

  <!-- ===== 共通スタイル（テンプレ内部は触らない） ===== -->
  <Window.Styles>
    <Style Selector="Button">
      <Setter Property="Background"   Value="{StaticResource ClrInputBg}"/>
      <Setter Property="BorderBrush"  Value="{StaticResource ClrInputBorder}"/>
      <Setter Property="Foreground"   Value="{StaticResource ClrText}"/>
      <Setter Property="CornerRadius" Value="8"/>
      <Setter Property="Padding"      Value="10,6"/>
    </Style>
    <Style Selector="Button:pointerover">
      <Setter Property="Background" Value="{StaticResource ClrBtnHover}"/>
    </Style>

    <Style Selector="ToggleButton">
      <Setter Property="Background"   Value="{StaticResource ClrInputBg}"/>
      <Setter Property="BorderBrush"  Value="{StaticResource ClrInputBorder}"/>
      <Setter Property="Foreground"   Value="{StaticResource ClrText}"/>
      <Setter Property="CornerRadius" Value="8"/>
      <Setter Property="Padding"      Value="8,6"/>
    </Style>
    <Style Selector="ToggleButton:pointerover">
      <Setter Property="Background" Value="{StaticResource ClrBtnHover}"/>
    </Style>

    <!-- TextBox 外観（Watermark色などは各 TextBox.Resources で上書き） -->
    <Style Selector="TextBox">
      <Setter Property="Foreground"   Value="{StaticResource ClrText}"/>
      <Setter Property="Background"   Value="{StaticResource ClrInputBg}"/>
      <Setter Property="BorderBrush"  Value="{StaticResource ClrInputBorder}"/>
      <Setter Property="CornerRadius" Value="8"/>
      <Setter Property="Padding"      Value="10,8"/>
    </Style>
    <Style Selector="TextBox:focus">
      <Setter Property="Foreground"   Value="{StaticResource ClrText}"/>
      <Setter Property="Background"   Value="{StaticResource ClrInputBg}"/>
      <Setter Property="BorderBrush"  Value="{StaticResource ClrFocusBorder}"/>
    </Style>

    <!-- DatePicker の表示部（内部 TextBox） -->
    <Style Selector="DatePicker TextBox">
      <Setter Property="Foreground"  Value="{StaticResource ClrText}"/>
      <Setter Property="Background"  Value="{StaticResource ClrInputBg}"/>
      <Setter Property="BorderBrush" Value="{StaticResource ClrInputBorder}"/>
    </Style>
    <Style Selector="DatePicker TextBox:focus">
      <Setter Property="BorderBrush" Value="{StaticResource ClrFocusBorder}"/>
    </Style>
  </Window.Styles>

  <!-- ===== 本体 ===== -->
  <StackPanel Margin="16" Spacing="8">

    <!-- ヘッダー -->
    <DockPanel>
      <TextBlock Text="To-Do" FontSize="22" FontWeight="SemiBold" DockPanel.Dock="Left"/>
      <Border DockPanel.Dock="Right" Width="120" Background="Transparent"/>
    </DockPanel>

    <!-- 入力行 -->
    <StackPanel Orientation="Horizontal" Spacing="8">
      <!-- Task title：背景は薄グレー固定、入力中の文字は白 -->
      <TextBox Width="400"
               Watermark="Task title"
               Text="{Binding NewTitle}">
        <TextBox.Resources>
          <!-- 入力文字・キャレットを白、背景は薄グレー固定 -->
          <SolidColorBrush x:Key="TextControlForeground"         Color="#FFFFFF"/>
          <SolidColorBrush x:Key="TextControlForegroundFocused"  Color="#FFFFFF"/>
          <SolidColorBrush x:Key="TextControlCaretBrush"         Color="#FFFFFF"/>
          <SolidColorBrush x:Key="TextControlBackground"         Color="#F3F4F6"/>
          <SolidColorBrush x:Key="TextControlBackgroundFocused"  Color="#F3F4F6"/>
          <SolidColorBrush x:Key="TextControlBorderBrush"        Color="#D1D5DB"/>
          <SolidColorBrush x:Key="TextControlBorderBrushFocused" Color="#93C5FD"/>
          <!-- Watermark（未入力時の薄文字） -->
          <SolidColorBrush x:Key="ThemeForegroundLowBrush"       Color="#6B7280"/>
        </TextBox.Resources>
        <TextBox.KeyBindings>
          <KeyBinding Command="{Binding AddCommand}" Gesture="Enter"/>
        </TextBox.KeyBindings>
      </TextBox>

      <!-- DatePicker：数字は黒、Watermarkは濃いグレー。背景は薄グレー固定 -->
      <DatePicker SelectedDate="{Binding NewDueDate}" Width="360">
        <DatePicker.Resources>
          <SolidColorBrush x:Key="ThemeForegroundBrush"      Color="#111827"/>
          <SolidColorBrush x:Key="ThemeForegroundLowBrush"   Color="#374151"/>
          <SolidColorBrush x:Key="TextControlBackground"         Color="#F3F4F6"/>
          <SolidColorBrush x:Key="TextControlBackgroundFocused"  Color="#F3F4F6"/>
          <SolidColorBrush x:Key="TextControlBorderBrush"        Color="#D1D5DB"/>
          <SolidColorBrush x:Key="TextControlBorderBrushFocused" Color="#93C5FD"/>
        </DatePicker.Resources>
      </DatePicker>

      <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
        <Button Content="Add"   Command="{Binding AddCommand}"/>
        <Button Content="Clear" Command="{Binding ClearInputCommand}"/>
      </StackPanel>
    </StackPanel>

    <!-- フィルタとソート -->
    <Grid ColumnDefinitions="*,Auto" Margin="0,4,0,0">
      <!-- フィルタボタン -->
      <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="10">
        <ToggleButton Content="All"       IsChecked="{Binding IsFilterAll, Mode=TwoWay}"/>
        <ToggleButton Content="Active"    IsChecked="{Binding IsFilterActive, Mode=TwoWay}"/>
        <ToggleButton Content="Completed" IsChecked="{Binding IsFilterCompleted, Mode=TwoWay}"/>
      </StackPanel>
      
      <!-- ソートボタン -->
      <Button Grid.Column="1" 
              Content="{Binding SortButtonText}" 
              Command="{Binding ToggleSortCommand}"
              ToolTip.Tip="Toggle sort order by due date"/>
    </Grid>

    <!-- 一覧 -->
    <ItemsControl ItemsSource="{Binding ViewItems}">
      <ItemsControl.ItemTemplate>
        <DataTemplate>
          <Border Padding="10" Margin="0,6"
                  Background="{StaticResource ClrItemBg}"
                  CornerRadius="10">
            <Grid ColumnDefinitions="Auto,*,Auto" VerticalAlignment="Center">

              <!-- ✅ 枠は小さめ、青いチェックは既定のまま -->
              <Grid Width="16" Height="16" VerticalAlignment="Center">
                <!-- 黒い枠（角少し丸め） -->
                <Border CornerRadius="3"
                        BorderBrush="#111827"
                        BorderThickness="1"/>
                <!-- 実際のチェックボックス -->
                <CheckBox IsChecked="{Binding IsCompleted, Mode=TwoWay}"
                          Command="{Binding $parent[Window].DataContext.ToggleCompletedCommand}"
                          CommandParameter="{Binding .}"
                          Background="Transparent"/>
              </Grid>

              <StackPanel Grid.Column="1" Margin="12,0,0,0">
                <TextBlock Text="{Binding Title}"
                           FontSize="14"
                           TextDecorations="{Binding IsCompleted, Converter={StaticResource BoolToTextDecorConverter}}"
                           Opacity="{Binding IsCompleted, Converter={StaticResource BoolToOpacityConverter}}"/>
                <Border Padding="6,2"
                        CornerRadius="999"
                        HorizontalAlignment="Left"
                        Background="{Binding IsOverdue, Converter={StaticResource BoolToBrushConverter}}">
                  <TextBlock Text="{Binding DueLabel}" FontSize="12"/>
                </Border>
              </StackPanel>

              <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" Margin="12,0,0,0" VerticalAlignment="Center">
                <Button Content="Delete"
                        Command="{Binding $parent[Window].DataContext.DeleteCommand}"
                        CommandParameter="{Binding .}"/>
              </StackPanel>

            </Grid>
          </Border>
        </DataTemplate>
      </ItemsControl.ItemTemplate>
    </ItemsControl>

  </StackPanel>
</Window>
